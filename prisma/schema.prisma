generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Doctor {
  id                 String        @id @default(cuid())
  name               String
  email              String        @unique
  phone              String?
  specialization     String?
  department         String?
  licenseNumber      String        @unique
  imageUrl           String?
  bio                String?
  experience_years   Int?
  education          String?
  certifications     String?
  consultation_fee   Int?
  specialtyImage_url String?
  is_executive       Boolean?
  sip_number         String?
  bpjs               Boolean?
  slug               String?       @unique
  kd_dokter          String?       @unique
  description        String?
  isActive           Boolean       @default(true)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  appointments       Appointment[]
  schedules          Schedule[]
  categories         Category[]    @relation("DoctorCategory")
}

model Category {
  id          String       @id @default(cuid())
  name        String
  slug        String       @unique
  type        CategoryType
  description String?
  icon        String?
  color       String?
  order       Int          @default(0)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  articles    Article[]    @relation("ArticleCategory")
  doctors     Doctor[]     @relation("DoctorCategory")
  services    Service[]    @relation("ServiceCategory")
}

model Appointment {
  id              String         @id @default(cuid())
  patientId       String
  patientName     String?
  patientPhone    String?
  patientEmail    String?
  patientAddress  String?
  doctorId        String
  appointmentDate DateTime
  status          String         @default("scheduled")
  reason          String?
  notes           String?
  createdByUserId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  createdByUser   User?          @relation("UserAppointments", fields: [createdByUserId], references: [id])
  doctor          Doctor         @relation(fields: [doctorId], references: [id])
  notifications   Notification[]
}

model Schedule {
  id          String   @id @default(cuid())
  doctorId    String
  dayOfWeek   Int
  startTime   String
  endTime     String
  maxPatients Int?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  doctor      Doctor   @relation(fields: [doctorId], references: [id])
}

model User {
  id            String         @id
  name          String
  email         String         @unique
  emailVerified Boolean        @default(false)
  image         String?
  role          String         @default("PATIENT")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  appointments  Appointment[]  @relation("UserAppointments")
  accounts      Account[]
  familyMembers FamilyMember[]
  prescriptions Prescription[] @relation("UserPrescriptions")
  sessions      Session[]
  profile       UserProfile?

  @@map("user")
}

model UserProfile {
  id        String    @id @default(cuid())
  userId    String    @unique
  phone     String?
  address   String?
  birthDate DateTime?
  gender    String?
  nik       String?
  bloodType String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profile")
}

model FamilyMember {
  id           String    @id @default(cuid())
  userId       String
  name         String
  relationship String
  nik          String?
  birthDate    DateTime?
  gender       String?
  phone        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("family_member")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Service {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String?
  icon        String?
  image       String?
  isActive    Boolean       @default(true)
  isFeatured  Boolean       @default(false)
  order       Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  subtitle    String?
  title       String?
  faqs        ServiceFaq[]
  items       ServiceItem[]
  categories  Category[]    @relation("ServiceCategory")
}

model ServiceItem {
  id          String   @id @default(cuid())
  serviceId   String
  category    String?
  name        String
  description String?
  price       Int?
  features    String?
  icon        String?
  imageUrl    String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
}

model ServiceFaq {
  id        String   @id @default(cuid())
  serviceId String
  question  String
  answer    String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
}

model Article {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  content     String
  excerpt     String?
  image       String?
  author      String?
  authorId    String?
  status      ArticleStatus @default(DRAFT)
  publishedAt DateTime?
  viewCount   Int           @default(0)
  isActive    Boolean       @default(true)
  isFeatured  Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  categories  Category[]    @relation("ArticleCategory")
}

model Notification {
  id               String       @id @default(cuid())
  type             String
  recipient        String
  recipientContact String
  message          String
  status           String
  appointmentId    String?
  sentAt           DateTime     @default(now())
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  appointment      Appointment? @relation(fields: [appointmentId], references: [id])
}

model Founder {
  id          String   @id @default(cuid())
  name        String
  role        String
  description String?
  image       String?
  badge       String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Milestone {
  id          String   @id @default(cuid())
  year        String
  title       String
  description String
  icon        String?
  highlight   Boolean  @default(false)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AboutContent {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CoreValue {
  id          String   @id @default(cuid())
  title       String
  description String
  icon        String
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Prescription {
  id                   String   @id @default(cuid())
  patientName          String
  patientPhone         String
  patientRM            String?
  prescriptionImageUrl String?
  deliveryMethod       String   @default("PICKUP")
  address              String?
  status               String   @default("SUBMITTED")
  note                 String?
  totalPrice           Int?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  userId               String?
  user                 User?    @relation("UserPrescriptions", fields: [userId], references: [id])

  @@map("prescriptions")
}

model Banner {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  description String?
  imageUrl    String
  link        String?
  linkText    String?  @default("Selengkapnya")
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("banners")
}

model Building {
  id          String   @id @default(cuid())
  kd_bangsal  String   @unique // Code from SIMRS Khanza
  name        String
  description String?
  imageUrl    String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("buildings")
}

model ExcludedBed {
  id        String   @id // kd_kamar from SIMRS
  reason    String?
  createdAt DateTime @default(now())

  @@map("excluded_beds")
}

enum CategoryType {
  POLI
  SPECIALIST
  SERVICE
  FACILITY
  EMERGENCY
  SUPPORT
  FEATURED
  DEPARTMENT
  ARTICLE_CATEGORY
  ARTICLE_TAG
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}
