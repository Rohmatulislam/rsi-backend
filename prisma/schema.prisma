generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Doctor {
  id                 String        @id @default(cuid())
  name               String
  email              String        @unique
  phone              String?
  specialization     String?
  department         String?
  licenseNumber      String        @unique
  imageUrl           String?
  bio                String?
  experience_years   Int?
  education          String?
  certifications     String?
  consultation_fee   Int?
  specialtyImage_url String?
  is_executive       Boolean?
  sip_number         String?
  bpjs               Boolean?
  slug               String?       @unique
  kd_dokter          String?       @unique
  description        String?
  isActive           Boolean       @default(true)
  isStudying         Boolean       @default(false)
  isOnLeave          Boolean       @default(false)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  appointments       Appointment[]
  schedules          Schedule[]
  categories         Category[]    @relation("DoctorCategory")
  exceptions         DoctorScheduleException[]
}

model DoctorScheduleException {
  id          String   @id @default(cuid())
  doctorId    String
  date        DateTime @db.Date
  type        String   // 'LEAVE', 'RESCHEDULE', 'EXTRA_QUOTA'
  startTime   String?  // If rescheduled
  endTime     String?
  note        String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  doctor      Doctor   @relation(fields: [doctorId], references: [id])

  @@unique([doctorId, date])
  @@map("doctor_schedule_exceptions")
}

model Category {
  id          String       @id @default(cuid())
  name        String
  slug        String       @unique
  type        CategoryType
  description String?
  icon        String?
  color       String?
  order       Int          @default(0)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  articles    Article[]    @relation("ArticleCategory")
  doctors     Doctor[]     @relation("DoctorCategory")
  services    Service[]    @relation("ServiceCategory")
}

model Appointment {
  id              String         @id @default(cuid())
  patientId       String
  patientName     String?
  patientPhone    String?
  patientEmail    String?
  patientAddress  String?
  doctorId        String
  appointmentDate DateTime
  status          String         @default("scheduled")
  reason          String?
  notes           String?
  noRawat         String?        @unique
  noReg           String?
  poliCode        String?
  payerName       String?
  payerCode       String?
  createdByUserId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  createdByUser   User?          @relation("UserAppointments", fields: [createdByUserId], references: [id])
  doctor          Doctor         @relation(fields: [doctorId], references: [id])
  notifications   Notification[]
}

model Schedule {
  id          String   @id @default(cuid())
  doctorId    String
  dayOfWeek   Int
  startTime   String
  endTime     String
  maxPatients Int?
  isActive    Boolean  @default(true)
  kd_poli     String?  // Code from SIMRS Khanza
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  doctor      Doctor   @relation(fields: [doctorId], references: [id])
}

model User {
  id                   String         @id @default(cuid())
  name                 String
  email                String         @unique
  password             String?        // For JWT auth
  phone                String?
  emailVerified        Boolean        @default(false)
  image                String?
  role                 String         @default("patient")
  passwordResetToken   String?
  passwordResetExpires DateTime?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  appointments         Appointment[]     @relation("UserAppointments")
  diagnosticOrders     DiagnosticOrder[] @relation("UserDiagnosticOrders")
  accounts             Account[]
  familyMembers        FamilyMember[]
  prescriptions        Prescription[] @relation("UserPrescriptions")
  sessions             Session[]
  profile              UserProfile?

  @@map("user")
}

model UserProfile {
  id        String    @id @default(cuid())
  userId    String    @unique
  phone     String?
  address   String?
  birthDate DateTime?
  gender    String?
  nik       String?
  bloodType String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profile")
}

model FamilyMember {
  id           String    @id @default(cuid())
  userId       String
  name         String
  relationship String
  nik          String?
  birthDate    DateTime?
  gender       String?
  phone        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("family_member")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Service {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String?
  icon        String?
  image       String?
  isActive    Boolean       @default(true)
  isFeatured  Boolean       @default(false)
  order       Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  subtitle    String?
  title       String?
  faqs        ServiceFaq[]
  items       ServiceItem[]
  categories  Category[]    @relation("ServiceCategory")
}

model ServiceItem {
  id          String   @id @default(cuid())
  serviceId   String
  category    String?
  name        String
  description String?
  price       Int?
  features    String?
  icon        String?
  imageUrl    String?
  videoUrl    String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
}

model ServiceFaq {
  id        String   @id @default(cuid())
  serviceId String
  question  String
  answer    String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
}

model Article {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  content     String
  excerpt     String?
  image       String?
  author      String?
  authorId    String?
  status      ArticleStatus @default(DRAFT)
  publishedAt DateTime?
  viewCount   Int           @default(0)
  isActive    Boolean       @default(true)
  isFeatured  Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  categories  Category[]    @relation("ArticleCategory")
}

model Notification {
  id               String       @id @default(cuid())
  type             String
  recipient        String
  recipientContact String
  message          String
  status           String
  appointmentId    String?
  sentAt           DateTime     @default(now())
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  appointment      Appointment? @relation(fields: [appointmentId], references: [id])
}

model Founder {
  id          String   @id @default(cuid())
  name        String
  role        String
  description String?
  image       String?
  badge       String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Milestone {
  id          String   @id @default(cuid())
  year        String
  title       String
  description String
  icon        String?
  highlight   Boolean  @default(false)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AboutContent {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CoreValue {
  id          String   @id @default(cuid())
  title       String
  description String
  icon        String
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Prescription {
  id                   String   @id @default(cuid())
  patientName          String
  patientPhone         String
  patientRM            String?
  prescriptionImageUrl String?
  deliveryMethod       String   @default("PICKUP")
  address              String?
  status               String   @default("SUBMITTED")
  note                 String?
  totalPrice           Int?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  userId               String?
  user                 User?    @relation("UserPrescriptions", fields: [userId], references: [id])

  @@map("prescriptions")
}

model Banner {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  description String?
  imageUrl    String
  link        String?
  linkText    String?  @default("Selengkapnya")
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("banners")
}

model Building {
  id          String   @id @default(cuid())
  kd_bangsal  String   @unique // Code from SIMRS Khanza
  name        String
  description String?
  imageUrl    String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("buildings")
}

model ExcludedBed {
  id        String   @id // kd_kamar from SIMRS
  reason    String?
  createdAt DateTime @default(now())

  @@map("excluded_beds")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  userEmail String
  action    String
  resource  String
  details   String?
  ipAddress String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("audit_logs")
}

model SiteStats {
  id           String   @id @default(cuid())
  key          String   @unique
  value        Int      @default(0)
  lastUpdated  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("site_stats")
}

enum CategoryType {
  POLI
  SPECIALIST
  SERVICE
  FACILITY
  EMERGENCY
  SUPPORT
  FEATURED
  DEPARTMENT
  ARTICLE_CATEGORY
  ARTICLE_TAG
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Partner {
  id        String   @id @default(cuid())
  name      String
  imageUrl  String
  link      String?
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("partners")
}

model Budget {
  id        String   @id @default(cuid())
  category  String   // e.g., 'Biaya Medis', 'Gaji', 'Listrik', 'Total Pengeluaran'
  amount    Float
  period    String   // 'monthly' | 'yearly'
  month     Int?     // 1-12
  year      Int
  notes     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([category, period, month, year])
  @@map("budget")
}

model DiagnosticOrder {
  id            String                @id @default(cuid())
  orderNumber   String                @unique
  patientId     String // no_rm from SIMRS
  patientName   String
  patientNIK    String
  patientPhone  String
  patientEmail  String?
  scheduledDate DateTime
  timeSlot      String
  totalAmount   Int
  status        DiagnosticOrderStatus @default(PENDING)
  paymentStatus PaymentStatus         @default(UNPAID)
  paymentMethod String?
  paymentId     String? // Midtrans ID reference
  notes         String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  items         DiagnosticOrderItem[]
  userId        String?
  user          User?                 @relation("UserDiagnosticOrders", fields: [userId], references: [id])

  @@map("diagnostic_orders")
}

model DiagnosticOrderItem {
  id      String          @id @default(cuid())
  orderId String
  itemId  String // Khanza ID or Local ID
  name    String
  price   Int
  type    String // MCU, LAB, RADIOLOGY
  order   DiagnosticOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("diagnostic_order_items")
}

enum DiagnosticOrderStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  UNPAID
  PAID
  EXPIRED
  FAILED
  REFUNDED
}

model TreatmentMetadata {
  id            String   @id @default(cuid())
  treatmentId   String   @unique // ID from SIMRS (e.g., PR00001)
  type          String // MCU, LAB, RADIOLOGY
  description   String?  @db.Text
  preparation   String?  @db.Text // JSON string or line-separated
  estimatedTime String?
  isPopular     Boolean  @default(false)
  imageUrl      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("treatment_metadata")
}

